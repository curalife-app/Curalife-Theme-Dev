<!-- GENERATED BY WISEPOPS, DO NOT EDIT THIS SNIPPET -->
<script>
    if (window._wisepopsSkipShopifyDeprecatedSnippet !== true) {
        document.addEventListener('wisepops.after-initialization', function (event) {
            // https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie/Simple_document.cookie_framework
            function getCookieValue(sKey) {
                if (!sKey) { return null; }
                return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(sKey).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) || null;
            };
            function getTotalInventoryQuantity() {
                var variants = {{ product.variants | default: null | json }};
                if (!variants) {
                    return null;
                }

                var totalQuantity = 0;
                for (var i in variants) {
                    if (variants[i] && variants[i].inventory_quantity) {
                        totalQuantity += variants[i].inventory_quantity;
                    } else {
                        return null;
                    }
                }
                return totalQuantity;
            }
            event.detail.wisepops('properties', {
                cart: {
                    discount_code: getCookieValue('discount_code'),
                    item_count: {{ cart.item_count | default: 0 }},
                    total_price: {{ cart.total_price | default: 0 }} / 100,
                },
                customer: {
                    accepts_marketing: {{ customer.accepts_marketing | json }},
                    is_logged_in: {% if customer %} true {% else %} false {% endif %},
                    last_order: {
                        created_at: {{ customer.last_order.created_at | date: "%FT%T%:z" | json }},
                    },
                    orders_count: {{ customer.orders_count | json }},
                    total_spent: (isNaN({{ customer.total_spent | json }}) ? null : ({{ customer.total_spent | json }} / 100)),
                    tags: {% if customer %} {{ customer.tags | join: "," | default: "" | json }} {% else %} null {% endif %},
                    email: {{ customer.email | json }},
                    first_name: {{ customer.first_name | json }},
                    last_name: {{ customer.last_name | json }},
                },
                product: {
                    available: {{ product.available | json }},
                    price: {% if product.price_varies == false %} {{ product.price | default: 0 }} / 100 {% else %} null {% endif %},
                    tags: {{ product.tags | join: "," | default: null | json  }},
                    total_inventory_quantity: getTotalInventoryQuantity(),
                },
            });
        });
    }
</script>
