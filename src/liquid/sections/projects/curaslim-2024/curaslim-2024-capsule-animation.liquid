<section class="capsule-animation-section">
  <div class="container">
    {% render 'title', section_id: section.id, title: '<span>One Capsule,</span> Triple Action', title_tag: 'h2', subtitle: '100% Natural, No Shots, No Chemicals', span_color: section.settings.title_highlight_color, padding_bottom: '30', padding_top: 0 %}

    <div class="view capsule-animation">
      <div class="pill relative flex justify-center">
        <img class="pill-half left mbl:w-2/3 m-0" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/pill-half.png?v=1723722706" alt="Curaslim 2024 Capsule Animation Pill Half">
        <img class="pill-half right mbl:w-2/3 m-0" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/pill_R.png?v=1724077162" alt="Curaslim 2024 Capsule Animation Pill Half">
      </div>

      <div class="fallen-items">
        <img class="fallen-item" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/3_Control_Craving_Portion.png?v=1723735924" alt="Curaslim 2024 Capsule Animation Fallen Item">
        <img class="fallen-item" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/3_Control_Craving_Portion3.png?v=1723735925" alt="Curaslim 2024 Capsule Animation Fallen Item">
        <img class="fallen-item" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/3_Control_Craving_Portion2.png?v=1723735925" alt="Curaslim 2024 Capsule Animation Fallen Item">
      </div>

        <img class="powder" src="https://cdn.shopify.com/s/files/1/0452/2459/1511/files/powder.png?v=1724075423" alt="Curaslim 2024 Capsule Animation Powder">

      {% comment %} <div class="confetti-container">
        <!-- Confetti particles will be dynamically added here -->
      </div> {% endcomment %}
    </div>
  </div>
</section>

<style>
    main {
        overflow: clip !important;
    }

    .capsule-animation-section {
        overflow: clip !important;
    }

    .capsule-animation {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: start;
        min-height: 800px;
        margin-top: 100px;
    }

    .pill {
        position: relative;
        z-index: 2;
    }

    .pill-half.left {
        animation: openPillLeft linear;
        animation-timeline: view();
        animation-range: cover 30% cover 100%;
        transform-origin: right center;
    }

    .pill-half.right {
        animation: openPillRight linear;
        animation-timeline: view();
        animation-range: cover 30% cover 100%;
        transform-origin: left center;
    }

    @keyframes openPillLeft {
        0% {
            transform: translateX(0) rotate(0deg);
        }
        100% {
            transform: translateX(-50%) rotate(30deg);
        }
    }

    @keyframes openPillRight {
        0% {
            transform: translateX(0) rotate(0deg);
        }
        100% {
            transform: translateX(50%) rotate(-30deg);
        }
    }

    .powder {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: -1;
        opacity: 0;
        animation: fadeInPowder linear;
        animation-timeline: view();
        animation-range: cover 50% cover 100%;
        animation-fill-mode: forwards;
    }

    @keyframes fadeInPowder {
        0% {
            opacity: 0;
        }
        20% {
            opacity: 0.7;
        }
        100% {
            opacity: 1;
        }
    }

    .fallen-items {
        position: absolute;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1;
        width: 300px;
        height: 300px;
    }

    .fallen-item {
        position: absolute;
        opacity: 0;
        animation: fallAnimation linear;
        animation-timeline: view();
        animation-range: cover 40% cover 100%;
        animation-fill-mode: forwards;
    }

    .fallen-item:nth-child(1) {
        animation-name: fallAnimationLeft;
    }

    .fallen-item:nth-child(2) {
        animation-name: fallAnimationCenter;
        animation-delay: 0.1s;
    }

    .fallen-item:nth-child(3) {
        animation-name: fallAnimationRight;
        animation-delay: 0.2s;
    }

    @keyframes fallAnimationLeft {
        0% {
            opacity: 0;
            width: 40%;
            transform: translate(50%, 0px);
        }
        20% {
            opacity: 1;
            width: 60%;
        }
        100% {
            opacity: 1;
            width: 100%;
            transform: translate(-100%, 500px);
        }
    }

    @keyframes fallAnimationCenter {
        0% {
            opacity: 0;
            width: 40%;
            transform: translate(50%, 0px);
        }
        20% {
            opacity: 1;
            width: 60%;
        }
        100% {
            opacity: 1;
            width: 100%;
            transform: translate(60%, 600px);
        }
    }

    @keyframes fallAnimationRight {
        0% {
            opacity: 0;
            width: 40%;
            transform: translate(50%, 0px);
        }
        20% {
            opacity: 1;
            width: 60%;
        }
        100% {
            opacity: 1;
            width: 100%;
            transform: translate(120%, 400px);
        }
    }

    @media (max-width: 768px) {
      @keyframes fallAnimationLeft {
          0% {
              opacity: 0;
              width: 40%;
              transform: translate(50%, 0px); /* Changed to 0% */
          }
          20% {
              opacity: 1;
              width: 60%;
          }
          100% {
              opacity: 1;
              width: 100%;
              transform: translate(0%, 500px); /* Changed to 0% */
          }
      }

      @keyframes fallAnimationCenter {
          0% {
              opacity: 0;
              width: 40%;
              transform: translate(50%, 0px); /* Changed to 0% */
          }
          20% {
              opacity: 1;
              width: 60%;
          }
          100% {
              opacity: 1;
              width: 100%;
              transform: translate(0%, 600px); /* Changed to 0% */
          }
      }

      @keyframes fallAnimationRight {
          0% {
              opacity: 0;
              width: 40%;
              transform: translate(50%, 0px); /* Changed to 0% */
          }
          20% {
              opacity: 1;
              width: 60%;
          }
          100% {
              opacity: 1;
              width: 100%;
              transform: translate(0%, 370px); /* Changed to 0% */
          }
      }
  }

    /* Confetti Styles */
    /* .confetti-container {
        position: absolute;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        height: 300px;
        pointer-events: none;
    }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #f0f0f0;
        opacity: 0;
        margin-left: 150px;
        animation: confettiFall linear;
        animation-timeline: view();
        animation-range: cover 30% cover 100%;
        animation-fill-mode: forwards;
    }

    @keyframes confettiFall {
        0% {
            opacity: 0;
            transform: translate(0, 0) rotate(0deg);
        }
        10% {
            opacity: 1;
        }
        100% {
            opacity: 0;
            transform: translate(var(--fall-x), var(--fall-y)) rotate(var(--rotation));
        }
    }

    @media (max-width: 768px) {
      @keyframes confettiFall {
        0% {
            opacity: 0;
            transform: translate(0, 0) rotate(0deg);
        }
        10% {
            opacity: 1;
        }
        100% {
          opacity: 0;
          transform: translate(var(--fall-x), calc(var(--fall-y) * 1.5)) rotate(var(--rotation)); /* Increase fall distance */
          }
    }
    } */
</style>

{% comment %} <script>
document.addEventListener('DOMContentLoaded', function() {
    const confettiContainer = document.querySelector('.confetti-container');
    const confettiColors = ['#0F7CBF', '#FFCB5E', '#FFB22D', '#c2c195', '#FFEBCD'];
    const confettiShapes = ['circle', 'square', 'triangle', 'rectangle'];

    for (let i = 0; i < 100; i++) {  // Increased from 50 to 100
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');

        const color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
        const shape = confettiShapes[Math.floor(Math.random() * confettiShapes.length)];
        const size = Math.random() * 8 + 4; // Random size between 4px and 12px

        confetti.style.backgroundColor = color;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;

        if (shape === 'circle') {
            confetti.style.borderRadius = '50%';
        } else if (shape === 'triangle') {
            confetti.style.width = '0';
            confetti.style.height = '0';
            confetti.style.backgroundColor = 'transparent';
            confetti.style.borderLeft = `${size/2}px solid transparent`;
            confetti.style.borderRight = `${size/2}px solid transparent`;
            confetti.style.borderBottom = `${size}px solid ${color}`;
        } else if (shape === 'rectangle') {
            confetti.style.height = `${size * 1.5}px`;
        }

        const fallX = (Math.random() - 0.5) * 600; // Random X position between -300px and 300px
        const fallY = Math.random() * 800 + 400; // Random Y position between 400px and 1200px
        const rotation = Math.random() * 720 - 360; // Random rotation between -360deg and 360deg
        const delay = Math.random() * 0.5; // Random delay up to 0.5s

        confetti.style.setProperty('--fall-x', `${fallX}px`);
        confetti.style.setProperty('--fall-y', `${fallY}px`);
        confetti.style.setProperty('--rotation', `${rotation}deg`);
        confetti.style.animationDelay = `${delay}s`;

        confettiContainer.appendChild(confetti);
    }
});
</script> {% endcomment %}

{% schema %}
  {
    "name": "Capsule Animation",
    "settings": [],
    "presets": [
      {
        "category": "Page",
        "name": "Capsule Animation"
      }
    ]
  }
{% endschema %}