{% comment %}
	SECTION: accordion-component.liquid
	Purpose: Displays a full-width background image with an overlay accordion widget.
{% endcomment %}

<style>
#accordion-component {
	position: relative;
	width: 100%;
	min-height: 400px;
	padding: 4rem;
	border-radius: 15px;
	background-size: cover;
	background-position: center;
	{% if section.settings.background_image != blank %}
	background-image: url('{{ section.settings.background_image | image_url: width:2000 }}');
	{% endif %}
}

.image-overlay-heading {
	position: absolute;
	z-index: 2;
	color: #fff;
	left: 4rem;
	bottom: 4rem;
	max-width: 40%;
}

/* Accordion widget styling */
.accordion-widget {
	background: #fff;
	padding: 3rem;
	box-shadow: 0 2px 10px rgba(0,0,0,0.1);
	border-radius: 8px;
	max-width: 40%;
	justify-self: end;
}

/* Accordion item styling */
.accordion-item {
	border-bottom: 1px solid #ccc;
	padding: 1rem 0;
}

.accordion-header {
	cursor: pointer;
	display: flex;
	justify-content: space-between;
	align-items: center;
	color: var(--primary-color);
	font-style: italic;
	font-weight: 100;
}

.accordion-content {
	overflow: hidden;
	max-height: 0;
	transition: max-height 0.3s ease;
	margin-top: 0.5rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
	#accordion-component {
		padding: 2rem;
		min-height: auto;
	}
	.image-overlay-heading {
		/* Remove absolute positioning on smaller screens */
		position: static;
		margin-bottom: 1rem;
		max-width: 100%;
		text-align: center;
	}
	.accordion-widget {
		max-width: 100%;
		padding: 2rem;
		margin: 0 auto;
	}
	.accordion-header {
		font-size: 1rem;
	}
	.accordion-content {
		font-size: 0.9rem;
	}
}
</style>

<section class="accordion-component-section">
	<div class="container">
		<div id="accordion-component">

			<!-- Optional overlay heading on the background image -->
			{% if section.settings.heading != blank %}
				<div class="image-overlay-heading">
					{{ section.settings.heading }}
				</div>
			{% endif %}

			<!-- Accordion Widget -->
			<div class="accordion-widget">
				{% for block in section.blocks %}
					{% if block.type == 'accordion_item' %}
						<div class="accordion-item">
							<h5 class="accordion-header">
								<span style="font-weight: bold;">{{ block.settings.month_title }}</span>
								<span class="accordion-icon" style="margin-left: 1rem;">+</span>
							</h5>
							<div class="accordion-content">
								{% if block.settings.subtitle != blank %}
									<h4 style="margin: 0 0 0.25rem;">{{ block.settings.subtitle }}</h4>
								{% endif %}
								<p style="margin: 0;">{{ block.settings.description }}</p>
							</div>
						</div>
					{% endif %}
				{% endfor %}
			</div>
		</div>
	</div>
</section>

<!-- JavaScript to handle accordion toggle -->
<script>
document.addEventListener('DOMContentLoaded', function() {
	var accordionHeaders = document.querySelectorAll('#accordion-component .accordion-header');

	accordionHeaders.forEach(function(header) {
		header.addEventListener('click', function() {
			var parentItem = header.parentElement;
			var content = parentItem.querySelector('.accordion-content');
			var icon = header.querySelector('.accordion-icon');

			// Close other open accordion items
			document.querySelectorAll('#accordion-component .accordion-content').forEach(function(otherContent) {
				if (otherContent !== content) {
					otherContent.style.maxHeight = "0px";
					otherContent.parentElement.querySelector('.accordion-icon').textContent = '+';
				}
			});

			// Toggle current accordion
			if (content.style.maxHeight && content.style.maxHeight !== "0px") {
				content.style.maxHeight = "0px";
				icon.textContent = '+';
			} else {
				content.style.maxHeight = content.scrollHeight + 'px';
				icon.textContent = '-';
			}
		});
	});
});
</script>

{% schema %}
{
	"name": "Accordion",
	"settings": [
		{
			"type": "richtext",
			"id": "heading",
			"label": "Overlay Heading",
			"default": "<h2>Your Journey: Shed Pounds & Feel Great</h2>"
		},
		{
			"type": "image_picker",
			"id": "background_image",
			"label": "Background Image"
		}
	],
	"blocks": [
		{
			"type": "accordion_item",
			"name": "Accordion Item",
			"settings": [
				{
					"type": "text",
					"id": "month_title",
					"label": "Month Title",
					"default": "Month 3"
				},
				{
					"type": "text",
					"id": "subtitle",
					"label": "Subtitle",
					"default": "Getting Started"
				},
				{
					"type": "textarea",
					"id": "description",
					"label": "Description",
					"default": "Take the product twice a day to establish a routine. Consistent use will help reduce cravings and build healthy habits."
				}
			]
		}
	],
	"max_blocks": 12,
	"presets": [
		{
			"name": "Accordion",
			"category": "Custom"
		}
	]
}
{% endschema %}
