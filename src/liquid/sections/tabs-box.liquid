{% assign tabs_amount = section.blocks.size %}

<section id="tab-box-{{ section.id }}" class="tabs-box-section admin-hidden text-center">
  <div class="container pt-4">
    <div class="tabbed-content tabs-side">
      <nav class="tabs min-w-[300px] xl:min-w-fit">
        {% for tab_block in section.blocks %}
          <div class="tab xl:min-w-[20vw]"><a href="#item-{{ forloop.index }}" {% if forloop.first %}class="active"{% endif %}>{{ tab_block.settings.tab_name }}</a></div>
        {% endfor %}
      </nav>

      <div class="content">
        {% for tab_block in section.blocks %}
          <div id="item-{{ forloop.index }}" class="item {% if forloop.first %}active always-active{% endif %}" data-title="{{ tab_block.settings.tab_name }}">
            <div class="item-content flex items-center">
              {% render 'responsive-image', img: tab_block.settings.tab_image, img_mobile: tab_block.settings.tab_image_mobile, classes: "w-1/2" %}

              <div class="content p-8">
                <p class="h5 font-bold">How we help</p>
                <p>{{ tab_block.settings.tab_description }}</p>
                <a href="{{ tab_block.settings.tab_link }}" class="font-bold underline">Learn More</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<style>
  .tabs-box-section .tabbed-content {
    display: flex;
    align-items: center;
    border-radius: 20px;
    overflow: hidden;
  }

  .tabs-box-section .tabbed-content .tabs {
    box-shadow: 0 25px 54px -35px rgb(0 0 0 / .25);
    background: white;
    display: none;
    z-index: 20;
    margin-bottom: unset;
  }

  .tabs-box-section .tabs .tab {
    text-align: center;
    height: calc(400px / {% if tabs_amount > 0 %}{{ tabs_amount }}{% else %}5{% endif %});
    background: var(--light-blue);
    border-radius: 10px;
    margin: 10px;
  }

  .tabs-box-section .tabs .tab a {
    height: 100%;
    align-items: center;
    display: flex;
    justify-content: center;
    transition: all 0.2s;
    border-radius: 10px;
    font-size: 24px;
  }

  .tabs-box-section .tabs .tab a:hover,
  .tabs-box-section .tabs .tab a.active {
    color: white;
    background: var(--blue);
  }

  .tabs-box-section .item {
    position: relative;
    z-index: 10px;
  }

  .tabs-box-section .item::before {
    content: attr(data-title);
    border-top: 1px solid var(--blue);
    cursor: pointer;
    font-weight: bold;
    padding: 0.5em;
    display: block;
    text-align: center;
  }

  .tabs-box-section .item:first-child::before {
    border-top: unset;
  }

  .tabs-box-section .item.active .item-content {
    background-color: var(--light-blue);
    transition: opacity 0.8s ease-in-out;
  }

  .tabs-box-section .tabbed-content .item {
    min-height: 2em;
  }

  .tabs-box-section .tabbed-content .item .item-content {
    opacity: 0;
    visibility: hidden;
    height: 0;
  }

  .tabs-box-section .tabbed-content .item.active .item-content {
    opacity: 1;
    visibility: visible;
    height: 440px;
  }

  @media all and (min-width: 768px) {
    .tabs-box-section .item-content {
      transition: transform 0.8s ease-out, opacity 0.8s ease-out;
    }

    .tabs-box-section .item {
      transition: transform 0.8s ease-out;
      z-index: 1;
    }

    .tabs-box-section .item.active {
      z-index: 10;
    }

    .tabs-box-section .arrow {
      transition: transform 0.5s ease-out, opacity 0.5s ease-out;
    }

    /* Apply 3D acceleration for smoother animations */
    .tabs-box-section .item-content,
    .tabs-box-section .item,
    .tabs-box-section .arrow {
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      perspective: 1000px;
    }

    .tabs-box-section .item.active .item-content {
      padding-top: 0;
    }

    .tabs-box-section .tabbed-content .tabs {
      display: block;
    }

    .tabs-box-section .tabbed-content .tabs .tab {
      display: inline-block;
    }

    .tabs-box-section .tabbed-content .tabs .tab:last-child {
      border-bottom: unset;
    }

    .tabs-box-section .tabbed-content .tabs .tab a {
      display: flex;
    }

    .tabs-box-section .tabbed-content .item {
      min-height: 0;
    }

    .tabs-box-section .tabbed-content .item::before {
      display: none;
    }

    .tabs-box-section .tabbed-content.tabs-side .tabs .tab {
      display: block;
    }
  }

  @media all and (max-width: 768px) {
    .tabs-box-section .tabbed-content {
      display: block;
      margin-left: unset !important;
    }

    .tabs-box-section .item::after {
      content: "+";
      font-size: 30px;
      position: absolute;
      top: 5px;
      right: 2vw;
      border: 2px solid var(--blue);
      border-radius: 50%;
      width: 5vw;
      height: 5vw;
      font-size: 5vw;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--blue);
    }

    .tabs-box-section .item.active::after {
      content: "-";
    }

    .tabs-box-section .tabbed-content .item.active .item-content {
      flex-direction: column;
      height: auto;
    }
  }

  @media screen and (max-width: 500px) {
    .tabs-box-section .item::after {
      top: 4vw;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabBox = document.querySelector('#tab-box-{{ section.id }}');
    if (!tabBox) return;

    tabBox.addEventListener('click', function(event) {
      const target = event.target;
      if (target.tagName !== 'A') return;

      event.preventDefault();
      const href = target.getAttribute('href');
      const targetItem = document.querySelector(href);
      if (!targetItem) return;

      const tabs = tabBox.querySelectorAll('.tabs a');
      const items = tabBox.querySelectorAll('.item');

      tabs.forEach(tab => tab.classList.remove('active'));
      items.forEach(item => item.classList.remove('active'));

      target.classList.add('active');
      targetItem.classList.add('active');
    });
  });
</script>

{% schema %}
  {
    "name": "Tabs Box",
    "class": "tabs-box-section",
    "settings": [],
    "blocks": [
      {
        "name": "Tab",
        "type": "tab",
        "settings": [
          {
            "type": "text",
            "id": "tab_name",
            "label": "Tab Name"
          },
          {
            "type": "image_picker",
            "id": "tab_image",
            "label": "Tab Image"
          },
          {
            "type": "image_picker",
            "id": "tab_image_mobile",
            "label": "Tab Image - Mobile"
          },
          {
            "type": "text",
            "id": "tab_description",
            "label": "Tab Description"
          },
          {
            "type": "url",
            "id": "tab_link",
            "label": "Tab Link URL"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Tabs Box"
      }
    ]
  }
{% endschema %}