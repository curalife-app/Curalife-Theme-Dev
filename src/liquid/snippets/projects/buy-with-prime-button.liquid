{% assign siteID = 'vgi1gktcrd' %}
{% assign widgetID = 'w-9AFp3mUw0t1xcJ0LkU4hT0' %}
{% comment %} {% assign productSKU = prodSKU | default: product.sku | default: product.selected_or_first_available_variant.sku | default: 'Curalin180' %} {% endcomment %}
{% assign productSKU = ProdSKU | default: 'Curalin180' %}

{% unless isNoScript %}
  <script defer src='https://code.buywithprime.amazon.com/default.variant.selector.shopify.js'></script>
  <script async fetchpriority='high' src='https://code.buywithprime.amazon.com/bwp.v1.js'></script>
{% endunless %}

<div id="bwp-{{ productSKU }}" class="buy-with-prime-button mt-[-10px]">
  <div id="amzn-bwp-cart" data-site-id="{{ siteID }}" data-widget-id="{{ widgetID }}"></div>
  <div id="amzn-buy-now" data-site-id="{{ siteID }}" data-widget-id="{{ widgetID }}" data-sku="{{ productSKU }}"></div>
</div>

{% comment %}
<style>
  .hide {pointer-events: none;}

  .buy-with-prime-button {
    min-height: 250px;
  }
</style>

 <script>
  function reloadIframe(newSku) {
    console.log("Reloading iframe with new SKU:", newSku);

    // Remove the existing iframe if it exists
    const existingIframe = document.getElementById('bwpFrame');
    if (existingIframe) {
      existingIframe.remove();
    }

    // Update the SKU on the div
    const buyNowDiv = $("#amzn-buy-now");
    buyNowDiv.attr('data-sku', newSku);

    // Ensure the new div is in place before reinitializing the script
    setTimeout(() => {
      // Remove old script tag if it exists
      $('script[src="https://code.buywithprime.amazon.com/bwp.v1.js"]').remove();

      // Add a new script tag to force reload
      const script = document.createElement('script');
      script.src = 'https://code.buywithprime.amazon.com/bwp.v1.js';
      script.async = true;
      script.fetchpriority = 'high';
      script.onload = () => {
        console.log("BuyWithPrime script loaded, initializing button");
      };
      document.body.appendChild(script);
    }, 100); // Adjust this delay if necessary to ensure the new div is rendered
  }

  $(".product-actions .variant-box").click(function() {
    let acceptableSKUs = ["Curalin180", "Curalin180x2", "Curalin180x3", "Curalin180x6"];
    let variantSKU = $(this).find('input').attr('data-sku');
    console.log("Variant clicked:", variantSKU);

    if (acceptableSKUs.includes(variantSKU)) {
      console.log("SKU is acceptable:", variantSKU);
      $(".buy-with-prime-button").fadeTo(300, 1).removeClass('hide');
      reloadIframe(variantSKU);
    } else {
      console.log("SKU is not acceptable:", variantSKU);
      $(".buy-with-prime-button").fadeTo(300, 0).addClass('hide');
    }
  });

  // Initial load of the script
  const initialScript = document.createElement('script');
  initialScript.src = 'https://code.buywithprime.amazon.com/bwp.v1.js';
  initialScript.async = true;
  initialScript.fetchpriority = 'high';
  document.body.appendChild(initialScript);
</script> {% endcomment %}
