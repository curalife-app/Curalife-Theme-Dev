{% comment %}
	Developer Tools Snippet

	This snippet contains all development-specific tools and scripts that should only
	load in development environments. This keeps the main theme.liquid clean.
{% endcomment %}

{% comment %} Stagewise Development Toolbar - Only in development {% endcomment %}
{% unless request.design_mode %}
	<script>
		// Only load stagewise in development environments
		// Check for development indicators including Shopify dev servers
		const isDevelopment =
			window.location.hostname === 'localhost' ||
			window.location.hostname.includes('127.0.0.1') ||
			window.location.hostname.includes('.ngrok.') ||
			window.location.hostname.includes('shopify.dev') ||
			window.location.hostname.includes('.shopifypreview.com') ||
			window.location.hostname.includes('.myshopify.com') ||
			window.location.search.includes('preview_theme_id') ||
			document.cookie.includes('_shopify_s=') ||
			window.location.port;

		console.log('ðŸŽ­ Hostname:', window.location.hostname);
		console.log('ðŸŽ­ Is development:', isDevelopment);

		if (isDevelopment) {
			// Load stagewise CSS
			const link = document.createElement('link');
			link.rel = 'stylesheet';
			link.href = '{{ "stagewise-toolbar.css" | asset_url }}';
			document.head.appendChild(link);

			// Load stagewise JavaScript bundle
			const script = document.createElement('script');
			script.src = '{{ "stagewise-toolbar.js" | asset_url }}';
			script.onload = () => {
				try {
					console.log('ðŸŽ­ Stagewise script loaded');
					console.log('ðŸŽ­ Window.StagewiseToolbar:', window.StagewiseToolbar);
					console.log('ðŸŽ­ Available properties:', Object.keys(window.StagewiseToolbar || {}));

					// Check if stagewise is available globally (it's exposed as StagewiseToolbar, not Stagewise)
					if (window.StagewiseToolbar && window.StagewiseToolbar.initToolbar) {
						console.log('ðŸŽ­ Initializing stagewise toolbar...');

						// Basic stagewise configuration
						const stagewiseConfig = {
							plugins: [],
							debug: true,
							position: 'top-right'
						};

						// Add connection status logging
						console.log('ðŸŽ­ Attempting to connect to Stagewise extension...');

						// Check if extension is available (this will help diagnose connection issues)
						setTimeout(() => {
							console.log('ðŸŽ­ Checking extension connection status...');
							// The toolbar should automatically try to connect to the VS Code extension
						}, 2000);

						// Initialize the toolbar
						window.StagewiseToolbar.initToolbar(stagewiseConfig);
						console.log('ðŸŽ­ Stagewise toolbar initialized for development');
					} else {
						console.warn('ðŸŽ­ Stagewise toolbar not found in global scope');
						console.warn(
							'ðŸŽ­ Available on window:',
							Object.keys(window).filter(k => k.toLowerCase().includes('stage'))
						);
					}
				} catch (error) {
					console.warn('Failed to initialize stagewise toolbar:', error);
				}
			};
			script.onerror = () => {
				console.warn('Failed to load stagewise toolbar script');
			};
			document.head.appendChild(script);
		} else {
			console.log('ðŸŽ­ Stagewise skipped - not in development environment');
			console.log('ðŸŽ­ To force enable, add ?stagewise=1 to URL');

			// Allow forcing stagewise with URL parameter
			if (window.location.search.includes('stagewise=1')) {
				console.log('ðŸŽ­ Force enabling stagewise via URL parameter');
				window.location.reload();
			}
		}
	</script>
{% endunless %}

{% comment %} Add other development tools here as needed {% endcomment %}
{% comment %}
	Future development tools can be added here, such as:
	- Performance monitoring scripts
	- Debug overlays
	- Development-specific analytics
	- A/B testing tools
{% endcomment %}
